#!/bin/sh

Mount() {

  if ( ! mount -l | grep "/media/SDCard" > /dev/null ); then
	 mount /media/SDCard && sleep 2
  fi

  if ( test -f /media/SDCard/Key ); then
     echo "Mounting..."      
     truecrypt --text --non-interactive /dev/disk/by-id/usb-WDC_WD64_00BEVT-22A0RT0_D1A201447088-0:0-part3 --keyfiles=/media/SDCard/Key
     if ( test "$?" = "1" ); then
        echo "Error!"
        return 1
     else 
        echo "Successful!"
        return 0
     fi
  else
     if ( test "$1" != "--silent" ); then
        echo "Keyfile not found!"
        return 1		 
	fi
  fi
}
  
Dismount() {
  echo "Dismounting..."
  truecrypt --text --non-interactive --dismount /dev/disk/by-id/usb-WDC_WD64_00BEVT-22A0RT0_D1A201447088-0:0-part3 
  if ( test "$?" = "1" ); then
     echo "Error!"
     return 1
  else 
     echo "Successful!"
     return 0
  fi  
}

# Main:
if ( test "$1" = "--dismount" ); then
   Dismount
else
   if ( test "$1" = "--mount" ); then
      Mount
   fi
fi
exit 0
